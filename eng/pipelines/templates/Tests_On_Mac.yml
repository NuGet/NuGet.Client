steps:
- task: UseDotNet@2
  displayName: 'Use .NET Core sdk'
  inputs:
    packageType: sdk
    version: 6.x
    installationPath: $(Agent.TempDirectory)/dotnet

- task: ShellScript@2
  displayName: "Run Tests (stop on error)"
  continueOnError: "false"
  inputs:
    scriptPath: "scripts/funcTests/runFuncTests2.sh"
    args: '6.0.3xx'
    disableAutoCwd: "true"
    cwd: "$(Build.Repository.LocalPath)"
  condition: "and(succeeded(), not(eq(variables['IsOfficialBuild'], 'true')))"

- script: |
    cd $BUILD_REPOSITORY_LOCALPATH
    ./cli/dotnet test ./test/NuGet.Core.Tests/NuGet.Common.Test/bin/release/netcoreapp3.1/NuGet.Common.Test.dll
    echo "single test exitcode is $?"

- script: |
    cd $BUILD_REPOSITORY_LOCALPATH
    echo "./cli/dotnet build ./test/NuGet.Core.Tests/NuGet.Common.Test/NuGet.Common.Test.csproj"
    ./cli/dotnet build ./test/NuGet.Core.Tests/NuGet.Common.Test/NuGet.Common.Test.csproj
    echo "./cli/dotnet test ./test/NuGet.Core.Tests/NuGet.Common.Test/bin/Debug/netcoreapp3.1/NuGet.Common.Test.dll"
    ./cli/dotnet test ./test/NuGet.Core.Tests/NuGet.Common.Test/bin/Debug/netcoreapp3.1/NuGet.Common.Test.dll --diag:$(Build.ArtifactStagingDirectory)/logs/log.txt
    echo "single test exitcode is $?"

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/logs'
    ArtifactName: 'logs'
    publishLocation: 'Container'
